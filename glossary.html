<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<title>Ø§Ù„Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ | ConsuTrain Hub</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="assets/css/style.css">
<!-- FAVICON -->
<link rel="icon" type="image/svg+xml"
  href='data:image/svg+xml,
  <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64">
    <defs>
      <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0" stop-color="%230b1f3a"/>
        <stop offset="1" stop-color="%2312345f"/>
      </linearGradient>
    </defs>

    <rect width="64" height="64" rx="14" fill="url(%23g)"/>
    <rect x="4" y="4" width="56" height="56" rx="12"
          fill="none" stroke="%23f2a93b" stroke-width="2"/>

    <text x="50%" y="54%" text-anchor="middle"
          font-family="Arial" font-size="26"
          font-weight="800" fill="%23eaf0ff">CTN</text>

    <text x="50%" y="82%" text-anchor="middle"
          font-family="Arial" font-size="12"
          font-weight="700" fill="%23f2a93b">PL</text>
  </svg>'>
</head>

<body>

<div id="site-header"></div>

<main class="site">
<section class="container">

<h1 class="page-title">Ø§Ù„Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</h1>
<p class="page-subtitle">Ù…ØµØ·Ù„Ø­Ø§Øª Ø¥Ø¯Ø§Ø±ÙŠØ© Ù…Ø¨Ø³Ø·Ø© Ù…Ø¹ Ø§Ù„ØªØ±Ø¬Ù…Ø©</p>


<div class="glossary-search-wrapper">
  <input id="glossarySearch" class="glossary-search"
         placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ØµØ·Ù„Ø­ Ø¹Ø±Ø¨ÙŠ Ø£Ùˆ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ">

  <div id="glossaryCounter" class="glossary-counter"></div>
</div>

<!-- ğŸ” Admin Bar -->
<div class="admin-bar">
  <button id="loginBtn" class="admin-btn">ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</button>
  <button id="logoutBtn" class="admin-btn danger" style="display:none">ğŸšª Ø®Ø±ÙˆØ¬</button>
</div>

<!-- ğŸ§© Admin Panel -->
<div id="adminPanel" class="admin-panel" style="display:none">
  <h3>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ù…ÙˆØ³</h3>
  <input id="newAr" placeholder="Ø§Ù„Ù…ØµØ·Ù„Ø­ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">
  <input id="newEn" placeholder="English Term">
  <textarea id="newDef" placeholder="Ø§Ù„ØªØ¹Ø±ÙŠÙ"></textarea>
  <button class="admin-btn primary" onclick="addTerm()">â• Ø¥Ø¶Ø§ÙØ© Ù…ØµØ·Ù„Ø­</button>
</div>

<div class="glossary-tools">
  <button onclick="exportPDF()">ğŸ“„ PDF</button>
  <button onclick="exportWord()">ğŸ“ Word</button>
  <button onclick="resetLocal()">â™»ï¸ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
</div>

<div id="glossaryList" class="glossary-list"></div>

</section>
</main>

<div id="site-footer"></div>

<!-- ğŸ—‘ Delete Confirmation Modal -->
<div id="deleteModal" class="modal-overlay" style="display:none">
  <div class="modal">
    <h3>âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h3>
    <p id="deleteModalText"></p>
    <div class="modal-actions">
      <button class="btn danger" id="confirmDeleteBtn">Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù</button>
      <button class="btn" onclick="closeDeleteModal()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<!-- ğŸ”„ Undo Toast -->
<div id="undoToast" class="undo-toast" style="display:none">
  <span>ğŸ—‘ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ØµØ·Ù„Ø­</span>
  <button onclick="undoDelete()">ØªØ±Ø§Ø¬Ø¹</button>
</div>

<script src="assets/js/includes.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
/* ========= CONFIG ========= */
const LS_KEY = "consutrain_glossary";
const ADMIN_KEY = "consutrain_admin";
const ADMIN_PASS = "admin123";

/* ========= STATE ========= */
let glossary = [];
let deleteIndex = null;
let lastDeleted = null;
let undoTimer = null;

/* ========= HELPERS ========= */
const $ = id => document.getElementById(id);
const saveLS = () => localStorage.setItem(LS_KEY, JSON.stringify(glossary));
const isAdmin = () => localStorage.getItem(ADMIN_KEY) === "1";

/* ========= RENDER ========= */
function render(list){
  $("glossaryCounter").textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ${list.length}`;

  $("glossaryList").innerHTML = list.map((i,index)=>`
    <article class="gterm">
      <h3>${i.ar}</h3>
      <div class="gterm__en">${i.en}</div>
      <p>${i.def}</p>

      <div class="gterm__footer">
        <button onclick="navigator.clipboard.writeText('${i.ar}')">Ù†Ø³Ø® Ø§Ù„Ù…ØµØ·Ù„Ø­</button>
        <button onclick="navigator.clipboard.writeText('${i.def}')">Ù†Ø³Ø® Ø§Ù„ØªØ¹Ø±ÙŠÙ</button>
        ${isAdmin() ? `
          <button class="copy-btn danger"
                  onclick="openDeleteModal(${index})">
            ğŸ—‘ Ø­Ø°Ù
          </button>` : ""}
      </div>
    </article>
  `).join("");
}

/* ========= LOAD ========= */
function load(){
  const ls = localStorage.getItem(LS_KEY);
  if(ls){
    glossary = JSON.parse(ls);
    render(glossary);
  }else{
    fetch("assets/data/glossary.json")
      .then(r=>r.json())
      .then(d=>{
        glossary = d.map(x=>({
          ar:x.term_ar,
          en:x.term_en,
          def:x.definition
        }));
        saveLS();
        render(glossary);
      });
  }
}

/* ========= SEARCH ========= */
$("glossarySearch").oninput = e=>{
  const q = e.target.value.toLowerCase();
  render(glossary.filter(i =>
    i.ar.includes(q) ||
    i.en.toLowerCase().includes(q) ||
    i.def.includes(q)
  ));
};

/* ========= ADD ========= */
function addTerm(){
  const ar=$("newAr").value.trim(),
        en=$("newEn").value.trim(),
        def=$("newDef").value.trim();

  if(!ar||!en||!def) return alert("Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");

  glossary.push({ar,en,def});
  saveLS();
  render(glossary);

  $("newAr").value=$("newEn").value=$("newDef").value="";
}

/* ========= DELETE + UNDO ========= */
function openDeleteModal(index){
  deleteIndex = index;
  $("deleteModalText").textContent =
    `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…ØµØ·Ù„Ø­: "${glossary[index].ar}" ØŸ`;
  $("deleteModal").style.display = "flex";
}

function closeDeleteModal(){
  deleteIndex = null;
  $("deleteModal").style.display = "none";
}

$("confirmDeleteBtn").onclick = ()=>{
  if(deleteIndex === null) return;

  lastDeleted = {
    item: glossary[deleteIndex],
    index: deleteIndex
  };

  glossary.splice(deleteIndex,1);
  saveLS();
  render(glossary);
  closeDeleteModal();
  showUndoToast();
};

function showUndoToast(){
  $("undoToast").style.display = "flex";
  clearTimeout(undoTimer);

  undoTimer = setTimeout(()=>{
    $("undoToast").style.display = "none";
    lastDeleted = null;
  }, 5000);
}

function undoDelete(){
  if(!lastDeleted) return;

  glossary.splice(lastDeleted.index, 0, lastDeleted.item);
  saveLS();
  render(glossary);

  lastDeleted = null;
  $("undoToast").style.display = "none";
  clearTimeout(undoTimer);
}

/* ========= ADMIN ========= */
$("loginBtn").onclick = ()=>{
  if(prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:") === ADMIN_PASS){
    localStorage.setItem(ADMIN_KEY,"1");
    location.reload();
  }
};

$("logoutBtn").onclick = ()=>{
  localStorage.removeItem(ADMIN_KEY);
  location.reload();
};

if(isAdmin()){
  $("adminPanel").style.display = "block";
  $("loginBtn").style.display = "none";
  $("logoutBtn").style.display = "inline-block";
}

/* ========= EXPORT ========= */
function exportPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  glossary.forEach((t,i)=>{
    pdf.text(`${i+1}. ${t.ar} - ${t.en}\n${t.def}`,10,10+i*15);
  });
  pdf.save("glossary.pdf");
}

function exportWord(){
  let html="<h1>Ø§Ù„Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</h1>";
  glossary.forEach(t=>{
    html+=`<h3>${t.ar} (${t.en})</h3><p>${t.def}</p>`;
  });
  const blob=new Blob([html],{type:"application/msword"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="glossary.doc";
  a.click();
}

function resetLocal(){
  if(confirm("Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©ØŸ")){
    localStorage.removeItem(LS_KEY);
    location.reload();
  }
}

load();
</script>
<script>
function injectGlossarySchema() {
  const schema = {
    "@context": "https://schema.org",
    "@type": "DefinedTermSet",
    "name": "Ø§Ù„Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ â€“ ConsuTrain Hub",
    "inDefinedTermSet": glossary.slice(0, 20).map(t => ({
      "@type": "DefinedTerm",
      "name": t.ar,
      "alternateName": t.en,
      "description": t.def,
      "inLanguage": "ar"
    }))
  };

  const s = document.createElement("script");
  s.type = "application/ld+json";
  s.textContent = JSON.stringify(schema);
  document.head.appendChild(s);
}

injectGlossarySchema();
</script>

<!---- scroll btn-->
 <button id="scrollTopBtn" aria-label="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰">
  â¬†ï¸
</button>
<script>
const scrollBtn = document.getElementById("scrollTopBtn");

window.addEventListener("scroll", () => {
  scrollBtn.style.display =
    window.scrollY > 300 ? "flex" : "none";
});

scrollBtn.onclick = () => {
  window.scrollTo({ top: 0, behavior: "smooth" });
};
</script>
<!---- End scroll btn-->
</body>
</html>
